<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Taming Time: Strategies for Out-of-Order and Delayed Processing | Learnings in IT</title>
<meta name="keywords" content="asynchronous, background-jobs, queue, message-broker, concurrency, distributed-systems">
<meta name="description" content="Summary
Explore various approaches to handle out-of-order or delayed processing, addressing scenarios like bulk operations and long-running tasks. Learn about message queues, background workers, and other techniques to improve application responsiveness.
Introduction
In the world of software development, we often encounter tasks that don&rsquo;t need to or (should not) be completed immediately. Whether it&rsquo;s sending mass emails, processing large datasets, or handling complex computations. Blocking the user&rsquo;s main flow (Either on Web App or API) for these operations is rarely a good idea. That&rsquo;s where out-of-order or delayed processing comes in.">
<meta name="author" content="map[name:Sachin Sunkle]">
<link rel="canonical" href="http://localhost:1313/posts/outoforder/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/outoforder/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Learnings in IT (Alt + H)">Learnings in IT</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/projects/" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="https://gist.github.com/sachinsu" title="Gists">
                    <span>Gists</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/home" title="Useful Links">
                    <span>Useful Links</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Taming Time: Strategies for Out-of-Order and Delayed Processing
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h1>
    <div class="post-meta"><span title='2025-04-01 10:25:04 +0530 IST'>Apr 1 2025</span>&nbsp;·&nbsp;map[name:Sachin Sunkle]

</div>
  </header> 
  <div class="post-content"><h2 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<p>Explore various approaches to handle out-of-order or delayed processing, addressing scenarios like bulk operations and long-running tasks. Learn about message queues, background workers, and other techniques to improve application responsiveness.</p>
<h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>In the world of software development, we often encounter tasks that don&rsquo;t need to or (should not) be completed immediately. Whether it&rsquo;s sending mass emails, processing large datasets, or handling complex computations. Blocking the user&rsquo;s main flow (Either on Web App or API) for these operations is rarely a good idea. That&rsquo;s where out-of-order or delayed processing comes in.</p>
<p>This post will delve into different strategies for managing these asynchronous tasks, comparing their strengths and weaknesses, and providing practical examples.</p>
<h3 id="use-cases">Use Cases<a hidden class="anchor" aria-hidden="true" href="#use-cases">#</a></h3>
<ul>
<li>Bulk Operations: Sending bulk emails, generating reports, or processing large files.</li>
<li>Long-Running Tasks: Video transcoding, complex calculations, or data analysis.</li>
<li>Non-Blocking User Interactions: Accepting user requests without waiting for completion, improving responsiveness</li>
</ul>
<h3 id="approaches">Approaches<a hidden class="anchor" aria-hidden="true" href="#approaches">#</a></h3>
<ol>
<li>
<p><strong>Thread Pools (In-Process Concurrency)</strong></p>
<ul>
<li><strong>Description:</strong> Using threads to execute tasks concurrently within the same application process.</li>
<li><strong>Pros:</strong> Simple to implement, low overhead for small tasks.</li>
<li><strong>Cons:</strong> Limited scalability, potential for resource contention, not suitable for distributed systems.</li>
<li><strong>Example (Go):</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">processTask</span>(<span style="color:#a6e22e">taskID</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Processing task %d\n&#34;</span>, <span style="color:#a6e22e">taskID</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tasks</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">task</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">tasks</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">processTask</span>(<span style="color:#a6e22e">id</span>)
</span></span><span style="display:flex;"><span>        }(<span style="color:#a6e22e">task</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><strong>Example (C#):</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Threading.Tasks;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">async</span> Task ProcessTask(<span style="color:#66d9ef">int</span> taskID)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Console.WriteLine($&#34;Processing task {taskID}&#34;);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> Task.Delay(taskID);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">async</span> Task Main(<span style="color:#66d9ef">string</span>[] args)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span>[] tasks = { <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span> };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> taskList = <span style="color:#66d9ef">new</span> Task[tasks.Length];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i = <span style="color:#ae81ff">0</span>; i &lt; tasks.Length; i++)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> taskID = tasks[i];
</span></span><span style="display:flex;"><span>            taskList[i] = ProcessTask(taskID);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> Task.WhenAll(taskList);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Console.WriteLine(<span style="color:#e6db74">&#34;All tasks completed.&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p><strong>Background Workers (Dedicated Processes or as a sidekick)</strong></p>
<ul>
<li><strong>Description:</strong> Running dedicated processes or services to handle background tasks.</li>
<li><strong>Pros:</strong> Good isolation, scalability, suitable for long-running tasks.</li>
<li><strong>Cons:</strong> Increased complexity, requires process management.</li>
<li><strong>Examples:</strong> Machinery (Go), Quartz.net (.NET), Hangfire (.NET).</li>
<li><strong>Often used with message queues.</strong></li>
<li><strong>Go:</strong> Implementing a background worker involves creating a separate executable, or using a library that facilitates background task execution like <a href=https://github.com/RichardKnop/machinery
    
    target=_blank rel="noopener noreferrer"
>Machinery</a>.</li>
<li><strong>C#</strong> , Out-of-process approach can be implemented using <a href=https://learn.microsoft.com/en-us/dotnet/core/extensions/windows-service
    
    target=_blank rel="noopener noreferrer"
>Windows Service</a> or <a href=https://devblogs.microsoft.com/dotnet/net-core-and-systemd/
    
    target=_blank rel="noopener noreferrer"
>Systemd</a> on Linux. Alternatively, dedicated processes can be run  as scoped service and process task(s) sequentially. Refer to &ldquo;Queued Background tasks&rdquo; example <a href=https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view&#61;aspnetcore-9.0&amp;tabs&#61;visual-studio#queued-background-tasks
    
    target=_blank rel="noopener noreferrer"
>here</a>.</li>
</ul>
</li>
<li>
<p><strong>Scheduled Tasks (Cron Jobs/Task Schedulers)</strong></p>
<ul>
<li><strong>Description:</strong> Executing tasks at specific intervals or times.</li>
<li><strong>Pros:</strong> Simple scheduling, suitable for recurring tasks.</li>
<li><strong>Cons:</strong> Less flexible than message queues, not ideal for event-driven tasks.</li>
<li><strong>Go:</strong> Using <code>cron</code> libraries like <a href=https://github.com/go-co-op/gocron
    
    target=_blank rel="noopener noreferrer"
>Gocron</a> or Windows Task Scheduler.</li>
<li><strong>C#:</strong> Using Windows Task Scheduler, or libraries like Quartz.NET/hangfire.</li>
</ul>
</li>
<li>
<p><strong>Message Queues (Asynchronous Communication)</strong></p>
<ul>
<li><strong>Description:</strong> Using a message broker (e.g., RabbitMQ, Kafka, Redis Pub/Sub) to decouple task producers and consumers.</li>
<li><strong>Pros:</strong> Scalable, fault-tolerant, supports distributed systems, excellent for decoupling.</li>
<li><strong>Cons:</strong> Requires additional infrastructure, increased complexity.</li>
<li><strong>Example (Conceptual):</strong>
<ul>
<li>Producer: Sends a message (task details) to a queue.</li>
<li>Consumer (Worker): Retrieves the message from the queue and processes the task.</li>
</ul>
</li>
<li><strong>Considerations:</strong> Message durability, delivery guarantees, message serialization.</li>
<li><strong>Go (using RabbitMQ):</strong> (Requires RabbitMQ client library)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Example using amqp library. Add error handling.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...</span>
</span></span></code></pre></div><ul>
<li><strong>C# (using RabbitMQ):</strong> (Requires RabbitMQ client library)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Example using RabbitMQ.Client library. Add error handling.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Asynchronous APIs (Callbacks/Promises/Async-Await)</strong></p>
<ul>
<li><strong>Description:</strong> Allowing client applications to initiate tasks and receive results later without blocking.</li>
<li><strong>Pros:</strong> Improves client-side responsiveness, good for web applications.</li>
<li><strong>Cons:</strong> Requires careful handling of asynchronous operations, potential for callback hell (older callback based approaches).d q</li>
<li><strong>Go:</strong> Using Goroutines and channels for asynchronous communication.</li>
<li><strong>C#:</strong> refer to implementation of Asynchronous (long-running) Apis <a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/async-request-reply
    
    target=_blank rel="noopener noreferrer"
>here</a>.</li>
</ul>
<p>Typical flow is as follow,</p>
<pre><code><figure>
            <img loading="lazy" src="/images/async-request.png"/> <figcaption>
                    Async Request/Reply pattern
                </figcaption>
        </figure>

</code></pre>
</li>
<li>
<p><strong>Outbox Pattern</strong></p>
<p><strong>Description:</strong> The Outbox Pattern provides a reliable way to publish events or messages when database transactions are involved. Instead of directly publishing messages to a message queue, events are stored in an <code>outbox</code> table within the same database. This helps with consistency issues as updates can be part of same transaction context.  A separate process then reads these events from the <code>outbox</code> table and publishes them to the message queue. This pattern is typically used alongside other patterns mentioned above.</p>
<ul>
<li>
<p><strong>Benefits:</strong></p>
<ul>
<li><strong>Atomicity:</strong> Ensures that events are published only if the database transaction succeeds.</li>
<li><strong>Reliability:</strong> Prevents message loss in case of application crashes or network issues.</li>
<li><strong>Decoupling:</strong> Decouples the application from the message queue.</li>
</ul>
</li>
<li>
<p><strong>Implementation:</strong>
1.  <strong>Outbox Table:</strong> Typical <code>outbox</code> table to store events:</p>
<pre><code>      ```sql
      CREATE TABLE outbox (
          id SERIAL PRIMARY KEY,
          payload JSONB NOT NULL,
          destination VARCHAR(255) NOT NULL,
          processed BOOLEAN NOT NULL DEFAULT FALSE,
          created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
      );
      ```
</code></pre>
<ol>
<li><strong>Publishing Events:</strong> When an event occurs, insert a row into the <code>outbox</code> table within the same database transaction as the business logic.</li>
<li><strong>Background Processor:</strong> Create a background process that reads events from the <code>outbox</code> table, publishes them to the message queue, and updates the <code>processed</code> column.</li>
<li><strong>Idempotency:</strong> ensure that the message consumer is idempotent, to handle possible duplicate messages.</li>
</ol>
</li>
</ul>
</li>
</ol>
<ul>
<li>
<p><strong>Example (C# with PostgreSQL):</strong></p>
<pre><code>    ```csharp
    using Npgsql;
    using System.Text;
    using System.Text.Json;
    using System.Threading;
    using System.Threading.Tasks;

    public class OutboxProcessor
    {
        private readonly string _connectionString;
        private readonly IConnection _rabbitConnection;

        public OutboxProcessor(string connectionString, IConnection rabbitConnection)
        {
            _connectionString = connectionString;
            _rabbitConnection = rabbitConnection;
        }

        public async Task ProcessOutbox(CancellationToken cancellationToken)
        {
            while (!cancellationToken.IsCancellationRequested)
            {
                try
                {
                    using (var connection = new NpgsqlConnection(_connectionString))
                    {
                        await connection.OpenAsync(cancellationToken);

                        using (var transaction = connection.BeginTransaction())
                        {
                            using (var command = new NpgsqlCommand(
                                &quot;SELECT id, payload, destination FROM outbox WHERE processed = FALSE FOR UPDATE SKIP LOCKED LIMIT 1&quot;,
                                connection, transaction))
                            {
                                using (var reader = await command.ExecuteReaderAsync(cancellationToken))
                                {
                                    if (await reader.ReadAsync(cancellationToken))
                                    {
                                        int id = reader.GetInt32(0);
                                        string payload = reader.GetString(1);
                                        string destination = reader.GetString(2);

                                        PublishToRabbitMQ(destination, payload);

                                        using (var updateCommand = new NpgsqlCommand(
                                            &quot;UPDATE outbox SET processed = TRUE WHERE id = @id&quot;, connection, transaction))
                                        {
                                            updateCommand.Parameters.AddWithValue(&quot;id&quot;, id);
                                            await updateCommand.ExecuteNonQueryAsync(cancellationToken);
                                        }
                                    }
                                }
                            }
                            await transaction.CommitAsync(cancellationToken);
                        }
                    }
                }
                catch (Exception ex)
                {
                    Console.WriteLine($&quot;Error processing outbox: {ex.Message}&quot;);
                }
                await Task.Delay(1000, cancellationToken);
            }
        }

        private void PublishToRabbitMQ(string destination, string payload)
        {
            using (var channel = _rabbitConnection.CreateModel())
            {
                channel.BasicPublish(exchange: &quot;&quot;, routingKey: destination, basicProperties: null, body: Encoding.UTF8.GetBytes(payload));
            }
        }
    }
    ```
Notice the use of `SELECT .... FOR UPDATE ..... SKIP LOCKED`. This is useful in case outbox table will be accessed/read concurrently by multiple processes. This ensures read operation will skip (and not wait) records that have `read lock`. This feature is available in most of RDBMS. 
</code></pre>
</li>
</ul>
<h3 id="comparison-table">Comparison Table<a hidden class="anchor" aria-hidden="true" href="#comparison-table">#</a></h3>
<table>
  <thead>
      <tr>
          <th>Approach</th>
          <th>Scalability</th>
          <th>Complexity</th>
          <th>Fault Tolerance</th>
          <th>Use Cases</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Thread Pools</td>
          <td>Low</td>
          <td>Low</td>
          <td>Low</td>
          <td>Simple, in-process tasks</td>
      </tr>
      <tr>
          <td>Message Queues</td>
          <td>High</td>
          <td>High</td>
          <td>High</td>
          <td>Distributed systems, decoupling, asynchronous communication</td>
      </tr>
      <tr>
          <td>Background Workers</td>
          <td>High</td>
          <td>Medium</td>
          <td>Medium</td>
          <td>Long-running tasks, dedicated processing</td>
      </tr>
      <tr>
          <td>Scheduled Tasks</td>
          <td>Medium</td>
          <td>Low</td>
          <td>Low</td>
          <td>Recurring tasks, scheduled operations</td>
      </tr>
      <tr>
          <td>Asynchronous APIs</td>
          <td>Medium</td>
          <td>Medium</td>
          <td>Medium</td>
          <td>Web applications, non-blocking client interactions, improved responsiveness</td>
      </tr>
      <tr>
          <td>&mdash;&mdash;&mdash;&ndash;</td>
          <td>&mdash;&mdash;&mdash;&mdash;&mdash;</td>
          <td>&mdash;&mdash;&mdash;&ndash;</td>
          <td>&mdash;&mdash;&mdash;&mdash;&mdash;</td>
          <td>&mdash;&mdash;&mdash;&mdash;</td>
      </tr>
  </tbody>
</table>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Choosing the right approach depends on the specific requirements of your application. Message queues and background workers offer excellent scalability and fault tolerance for complex, distributed systems. Thread pools and scheduled tasks are suitable for simpler scenarios. Asynchronous APIs are crucial for improving client-side responsiveness in web applications.</p>
<p>By understanding these techniques, you can effectively manage out-of-order and delayed processing, enhancing the performance and user experience of your applications.</p>
<h3 id="useful-links-usefullinks">Useful links (#usefullinks)<a hidden class="anchor" aria-hidden="true" href="#useful-links-usefullinks">#</a></h3>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/asynchronous/">Asynchronous</a></li>
      <li><a href="http://localhost:1313/tags/background-jobs/">Background-Jobs</a></li>
      <li><a href="http://localhost:1313/tags/queue/">Queue</a></li>
      <li><a href="http://localhost:1313/tags/message-broker/">Message-Broker</a></li>
      <li><a href="http://localhost:1313/tags/concurrency/">Concurrency</a></li>
      <li><a href="http://localhost:1313/tags/distributed-systems/">Distributed-Systems</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Learnings in IT</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
