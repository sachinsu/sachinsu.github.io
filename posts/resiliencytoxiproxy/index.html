<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Resiliency Testing with Toxiproxy - Learnings in IT</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:url" content="https://sachinsu.github.io/posts/resiliencytoxiproxy/"><meta property="og:site_name" content="Learnings in IT"><meta property="og:title" content="Resiliency Testing with Toxiproxy"><meta property="og:description" content="Background In a typical workflow of software development, Developer implements a Unit/component, tests it and pushes the changes to source control repository. It then goes through Continuous integration, automated testing, provisioning and deployment. Given High availability requirements expected (or should i say assumed) nowadays, As much as functional correctness of the Unit, it is also important to test how a Unit/Component handles failures, delays etc. in distributed environment. Often, such behavior is observed in production itself, unless project team is following practices of Chaos engineering."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-09T10:25:04+05:30"><meta property="article:modified_time" content="2021-01-09T10:25:04+05:30"><meta property="article:tag" content="Chaosengineering"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Postgresql"><meta property="article:tag" content="Toxiproxy"><meta property="article:tag" content="Shopify"><meta itemprop=name content="Resiliency Testing with Toxiproxy"><meta itemprop=description content="Background In a typical workflow of software development, Developer implements a Unit/component, tests it and pushes the changes to source control repository. It then goes through Continuous integration, automated testing, provisioning and deployment. Given High availability requirements expected (or should i say assumed) nowadays, As much as functional correctness of the Unit, it is also important to test how a Unit/Component handles failures, delays etc. in distributed environment. Often, such behavior is observed in production itself, unless project team is following practices of Chaos engineering."><meta itemprop=datePublished content="2021-01-09T10:25:04+05:30"><meta itemprop=dateModified content="2021-01-09T10:25:04+05:30"><meta itemprop=wordCount content="473"><meta itemprop=keywords content="Chaosengineering,Golang,Postgresql,Toxiproxy,Shopify"><meta name=twitter:card content="summary"><meta name=twitter:title content="Resiliency Testing with Toxiproxy"><meta name=twitter:description content="Background In a typical workflow of software development, Developer implements a Unit/component, tests it and pushes the changes to source control repository. It then goes through Continuous integration, automated testing, provisioning and deployment. Given High availability requirements expected (or should i say assumed) nowadays, As much as functional correctness of the Unit, it is also important to test how a Unit/Component handles failures, delays etc. in distributed environment. Often, such behavior is observed in production itself, unless project team is following practices of Chaos engineering."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Learnings in IT" rel=home><div class="logo__item logo__text"><div class=logo__title>Learnings in IT</div><div class=logo__tagline>A Simple Technical Blog</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li><li class=menu__item><a class=menu__link href=/posts/><span class=menu__text>Blog</span></a></li><li class=menu__item><a class=menu__link href=/projects/><span class=menu__text>Projects</span></a></li><li class=menu__item><a class=menu__link href=https://gist.github.com/sachinsu><span class=menu__text>Gists</span></a></li><li class=menu__item><a class=menu__link href=/links/home><span class=menu__text>Useful Links</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Resiliency Testing with Toxiproxy</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2021-01-09T10:25:04+05:30>Jan 9 2021</time></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#background>Background</a><ul><li><a href=#lets-use-toxiproxy>Lets use Toxiproxy</a></li><li><a href=#useful-references>Useful References,</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><h2 id=background>Background</h2><p>In a typical workflow of software development, Developer implements a Unit/component, tests it and pushes the changes to source control repository. It then goes through Continuous integration, automated testing, provisioning and deployment. Given High availability requirements expected (or should i say assumed) nowadays, As much as functional correctness of the Unit, it is also important to test how a Unit/Component handles failures, delays etc. in distributed environment. Often, such behavior is observed in production itself, unless project team is following practices of <a href=https://netflixtechblog.com/tagged/chaos-engineering target=_blank rel="noopener noreferrer">Chaos engineering</a>.</p><p>Wouldn&rsquo;t it be great if it is possible to start testing the resiliency features as part of development and during CI/CD pipeline execution itself ? Enter <a href=https://toxiproxy.io target=_blank rel="noopener noreferrer">Toxiproxy</a></p><p>Toxiproxy is a TCP Proxy to simulate network and system conditions for chaos and resiliency Testing.</p><p>Toxiproxy essentially acts as middleman between your application and remote service/system being tested, allowing injection of delays, simulate Bandwidth restriction or turn interface off (down)
etc.</p><p>It provides CLI as well as http API for applications to inject these behaviors or toxics. Refer <a href=https://github.com/shopify/toxiproxy#toxics target=_blank rel="noopener noreferrer">here</a> for various toxics supported.</p><h3 id=lets-use-toxiproxy>Lets use Toxiproxy</h3><p>Lets see how one can use it in typical use case where Application uses PostgreSQL database and requirement is to benchmark it against database hosted remotely. Toxiproxy can help simulate production like behavior by means of introducing network delay.</p><p>The full source code of this application is available <a href=https://github.com/sachinsu/toxiproxyPOC target=_blank rel="noopener noreferrer">here</a>. One can refer to Numbers (only as reference cause live conditions may widely vary) <a href=https://github.com/sirupsen/napkin-math target=_blank rel="noopener noreferrer">here</a> while deciding on how much toxicity to introduce.</p><p>Application itself is a Web server in <a href=https://golang.org target=_blank rel="noopener noreferrer">Go</a> using excellent <a href=https://github.com/julienschmidt/httprouter target=_blank rel="noopener noreferrer">HTTPRouter</a>, It does,</p><ul><li><p>provision a table in Postgresql and load <a href=https://github.com/sachinsu/toxiproxyPOC/tree/main/assets target=_blank rel="noopener noreferrer">dummy data</a> in it.</p></li><li><p>Exposes REST API that reads data from database and returns JSON</p></li><li><p>Setup proxy between application and database either through Toxiproxy CLI (it can also be done programmatically using Toxiproxy-Go client),</p><pre tabindex=0><code>    [
        {
            &#34;name&#34;: &#34;pgsql&#34;, 
            &#34;listen&#34; : &#34;[::]:6000&#34;,
            &#34;upstream&#34; : &#34;127.0.0.1:5432&#34;,
            &#34;enabled&#34;: true
        }
    ]
</code></pre><p>or through Code like,</p><pre tabindex=0><code>    // InjectLatency helper
    func InjectLatency(name string, delay int) *toxiproxy.Proxy {
        proxy, err := toxiClient.Proxy(name)

        if err != nil {
            panic(err)
        }

        proxy.AddToxic(&#34;&#34;, &#34;latency&#34;, &#34;&#34;, 1, toxiproxy.Attributes{
            &#34;latency&#34;: delay,
        })
        return proxy
    }
</code></pre></li><li><p>Use <a href=https://github.com/rakyll/hey target=_blank rel="noopener noreferrer">hey</a> or any other HTTP Benchmarking tool to test end points with and without toxicity</p></li></ul><p>or</p><ul><li>Go <a href=https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go target=_blank rel="noopener noreferrer">benchmark</a> <a href=https://github.com/sachinsu/toxiproxyPOC/tree/main/api/server target=_blank rel="noopener noreferrer">tests</a> tests that are executed against HTTP end points.</li></ul><p>In my opinion, Toxiproxy allows us to embed aspect(s) of resiliency verification in the code itself so developer can test it before committing the code and it can be embedded in DevOps pipeline to get early feedback before facing the music in production environment.</p><p>Like latency, one can easily introduce other Toxics like Bandwidth, Down and Timeout to check Application&rsquo;s behavior when faced with such occurrences.</p><h3 id=useful-references>Useful References,</h3><ul><li><a href=https://toxiproxy.io target=_blank rel="noopener noreferrer">ToxiProxy</a> - for all details on the tool like Clients available in various languages, server releases and so on.</li></ul><p>Happy Coding !!</p><hr><script src=https://utteranc.es/client.js repo=sachinsu/sachinsu.github.io issue-term=title label=blogcomment theme=github-light crossorigin=anonymous async></script></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/chaosengineering/ rel=tag>Chaosengineering</a></li><li class=tags__item><a class="tags__link btn" href=/tags/golang/ rel=tag>golang</a></li><li class=tags__item><a class="tags__link btn" href=/tags/postgresql/ rel=tag>postgresql</a></li><li class=tags__item><a class="tags__link btn" href=/tags/toxiproxy/ rel=tag>toxiproxy</a></li><li class=tags__item><a class="tags__link btn" href=/tags/shopify/ rel=tag>shopify</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/temporalworkflow/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>Using Temporal.io to build Long running Workflows</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/posts/restapiversioning/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Learnings from Jeff Richter's Designing and Versioning HTTP REST APIs Video Course</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2025 Sachin Sunkle.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>