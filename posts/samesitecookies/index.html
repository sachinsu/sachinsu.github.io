<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>ASP.NET Core - Mind the SameSite HTTP Cookie settings - Learnings in IT</title>
<script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="ASP.NET Core - Mind the SameSite HTTP Cookie settings"><meta property="og:description" content="Background A Web Application, developed in ASP.NET Core (Runtime Version 3.1.100) using Razor Pages and Web API, is expected to be launched from within third-party Web Application in iframe, with complete HTML being rendered.
During the Development, a mock HTML Page was developed to simulate launching of ASP.NET core based Web Application in iframe. Note that this page as well as Application was hosted on same IIS Server and it worked fine."><meta property="og:type" content="article"><meta property="og:url" content="https://sachinsu.github.io/posts/samesitecookies/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-09T10:25:04+05:30"><meta property="article:modified_time" content="2020-04-09T10:25:04+05:30"><meta itemprop=name content="ASP.NET Core - Mind the SameSite HTTP Cookie settings"><meta itemprop=description content="Background A Web Application, developed in ASP.NET Core (Runtime Version 3.1.100) using Razor Pages and Web API, is expected to be launched from within third-party Web Application in iframe, with complete HTML being rendered.
During the Development, a mock HTML Page was developed to simulate launching of ASP.NET core based Web Application in iframe. Note that this page as well as Application was hosted on same IIS Server and it worked fine."><meta itemprop=datePublished content="2020-04-09T10:25:04+05:30"><meta itemprop=dateModified content="2020-04-09T10:25:04+05:30"><meta itemprop=wordCount content="428"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="ASP.NET Core - Mind the SameSite HTTP Cookie settings"><meta name=twitter:description content="Background A Web Application, developed in ASP.NET Core (Runtime Version 3.1.100) using Razor Pages and Web API, is expected to be launched from within third-party Web Application in iframe, with complete HTML being rendered.
During the Development, a mock HTML Page was developed to simulate launching of ASP.NET core based Web Application in iframe. Note that this page as well as Application was hosted on same IIS Server and it worked fine."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-169012216-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Learnings in IT" rel=home><div class="logo__item logo__text"><div class=logo__title>Learnings in IT</div><div class=logo__tagline>A Simple Technical Blog</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li><li class=menu__item><a class=menu__link href=/posts/><span class=menu__text>Blog</span></a></li><li class=menu__item><a class=menu__link href=/projects/><span class=menu__text>Projects</span></a></li><li class=menu__item><a class=menu__link href=https://gist.github.com/sachinsu><span class=menu__text>Gists</span></a></li><li class=menu__item><a class=menu__link href=/links/home><span class=menu__text>Useful Links</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>ASP.NET Core - Mind the SameSite HTTP Cookie settings</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>Sachin Sunkle</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-04-09T10:25:04+05:30>Apr 9 2020</time></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#background>Background</a><ul><li></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><h2 id=background>Background</h2><p>A Web Application, developed in ASP.NET Core (Runtime Version 3.1.100) using Razor Pages and Web API, is expected to be launched from within third-party Web Application in iframe, with complete HTML being rendered.</p><p>During the Development, a mock HTML Page was developed to simulate launching of ASP.NET core based Web Application in iframe. Note that this page as well as Application was hosted on same IIS Server and it worked fine. Subsequently, Web Application was deployed on Test Server and URL was shared for integration with third party Application and then it happened Boom&mldr;. i.e. Application when launched in iframe rendered HTML but none of the post request would work (returning HTTP Error 400). Careful inspection showed that,</p><ul><li><p>Browser&rsquo;s <a href=https://developers.google.com/web/tools/chrome-devtools target=_blank rel="noopener noreferrer">Dev tools</a> showed HTTP 400</p></li><li><p>There were no entries in Application&rsquo;s Log File which indicates that Request was rejected either by IIS or ASP.NET Core&rsquo;s chain of filters i.e. even before it reaches handler.</p></li><li><p>IIS Log depicted that Request was rejected but had no additional details. May be some of the log settings were missing.</p></li><li><p>Next up is to carefully look at Request sent by browser in &lsquo;Network&rsquo; tab of Dev tools. It showed that none of the cookies required by Application (i.e. for Session, CSRF token etc.) were present.</p></li></ul><p>Enter <a href="https://docs.microsoft.com/en-us/aspnet/core/security/samesite?view=aspnetcore-3.1" target=_blank rel="noopener noreferrer">SameSite</a></p><h4 id=samesite>SameSite</h4><p>SameSite is a standard designed to provide some protection against cross-site request forgery (CSRF) attacks. Support for Samesite was added from .NET Core 2.2 and onwards. It is expected that developer will control the value of SameSite attribute using <code>HttpCookie.SameSite</code> property.Setting the SameSite property to Strict, Lax, or None results in those values being written on the network with the cookie.</p><ul><li>Cookies without SameSite header are treated as SameSite=Lax by default.</li><li>SameSite=None must be used to allow cross-site cookie use.</li><li>Cookies that assert SameSite=None must also be marked as Secure.</li><li>Applications that use <code>&lt;iframe></code> may experience issues with sameSite=Lax or sameSite=Strict cookies because <code>&lt;iframe></code> is treated as cross-site scenarios.</li><li>The value SameSite=None is not allowed by the 2016 standard and causes some implementations to treat such cookies as SameSite=Strict.</li></ul><p>The SameSite=Lax setting works for most application cookies.</p><p>Accordingly, below settings were made in startup.cs of the ASP.NET Core Application.</p><pre tabindex=0><code>services.AddSession(options =&gt;
            {
                options.IdleTimeout = TimeSpan.FromMinutes(30);
                options.Cookie.HttpOnly = true;
                // Samesite Settings.
                options.Cookie.SameSite = SameSiteMode.Lax;
                options.Cookie.IsEssential = true;
            });

services.AddAntiforgery(options =&gt;
{
    options.Cookie.SameSite = SameSiteMode.Lax;
});
</code></pre><h5 id=references>References</h5><ul><li><a href=https://techcommunity.microsoft.com/t5/iis-support-blog/samesite-cookie-updates-in-asp-net-or-how-the-net-framework-from/ba-p/1156246 target=_blank rel="noopener noreferrer">SameSite cookie updates in ASP.net, or how the .Net Framework from December changed my cookie usage.</a></li><li><a href=https://techcommunity.microsoft.com/t5/iis-support-blog/changes-in-samesite-cookie-in-asp-net-core-and-how-it-impacts/ba-p/1150771 target=_blank rel="noopener noreferrer">Changes in SameSite Cookie in ASP.NET/Core and How it Impacts the Browser (Specifically Chrome)</a></li><li><a href=https://http203.libsyn.com/fish-scripts-special target=_blank rel="noopener noreferrer">HTTP 203 Podcast covering CORS,CORB, Samesite</a></li></ul><p>Happy Coding !!</p><hr><script src=https://utteranc.es/client.js repo=sachinsu/sachinsu.github.io issue-term=title label=blogcomment theme=github-light crossorigin=anonymous async></script></div></article></main><div class="authorbox clearfix"><div class=authorbox__header><span class=authorbox__name>About Sachin Sunkle</span></div><div class=authorbox__description>A Coder in IT</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/channelsforproducerconsumer/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>Using Channels for High performance Producer consumer implementation</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/posts/usingbenchmarkdotnet/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Optimizing .NET Code using Benchmarks</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 Sachin Sunkle.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>