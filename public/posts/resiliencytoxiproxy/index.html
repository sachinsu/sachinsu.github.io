<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Resiliency Testing with Toxiproxy - Learnings in IT</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Resiliency Testing with Toxiproxy" />
<meta property="og:description" content="Background In a typical workflow of software development, Developer implements a Unit/component, tests it and pushes the changes to source control repository. It then goes through Continuous integration, automated testing, provisioning and deployment. Given High availability requirements expected (or should i say assumed) nowadays, As much as functional correctness of the Unit, it is also important to test how a Unit/Component handles failures, delays etc. in distributed environment. Often, such behavior is observed in production itself, unless project team is following practices of Chaos engineering." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sachinsu.github.io/posts/resiliencytoxiproxy/" />
<meta property="article:published_time" content="2021-01-09T10:25:04+05:30" />
<meta property="article:modified_time" content="2021-01-09T10:25:04+05:30" />

		<meta itemprop="name" content="Resiliency Testing with Toxiproxy">
<meta itemprop="description" content="Background In a typical workflow of software development, Developer implements a Unit/component, tests it and pushes the changes to source control repository. It then goes through Continuous integration, automated testing, provisioning and deployment. Given High availability requirements expected (or should i say assumed) nowadays, As much as functional correctness of the Unit, it is also important to test how a Unit/Component handles failures, delays etc. in distributed environment. Often, such behavior is observed in production itself, unless project team is following practices of Chaos engineering.">
<meta itemprop="datePublished" content="2021-01-09T10:25:04&#43;05:30" />
<meta itemprop="dateModified" content="2021-01-09T10:25:04&#43;05:30" />
<meta itemprop="wordCount" content="473">



<meta itemprop="keywords" content="Chaosengineering,golang,postgresql,toxiproxy,shopify," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Resiliency Testing with Toxiproxy"/>
<meta name="twitter:description" content="Background In a typical workflow of software development, Developer implements a Unit/component, tests it and pushes the changes to source control repository. It then goes through Continuous integration, automated testing, provisioning and deployment. Given High availability requirements expected (or should i say assumed) nowadays, As much as functional correctness of the Unit, it is also important to test how a Unit/Component handles failures, delays etc. in distributed environment. Often, such behavior is observed in production itself, unless project team is following practices of Chaos engineering."/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-169012216-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="Learnings in IT" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Learnings in IT</div>
					<div class="logo__tagline">A Simple Technical Blog</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/posts/">
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/projects/">
				
				<span class="menu__text">Projects</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="https://gist.github.com/sachinsu">
				
				<span class="menu__text">Gists</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/links/home">
				
				<span class="menu__text">Useful Links</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Resiliency Testing with Toxiproxy</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">Sachin Sunkle</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2021-01-09T10:25:04&#43;05:30">Jan 9 2021</time></div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a>
      <ul>
        <li><a href="#lets-use-toxiproxy">Lets use Toxiproxy</a></li>
        <li><a href="#useful-references">Useful References,</a></li>
      </ul>
    </li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<h2 id="background">Background</h2>
<p>In a typical workflow of software development, Developer implements a Unit/component, tests it and pushes  the changes to source control repository. It then goes through Continuous integration, automated testing, provisioning and deployment. Given High availability requirements expected (or should i say assumed) nowadays,  As much as functional correctness of the Unit, it is also important to test how a Unit/Component handles failures, delays etc. in distributed environment.  Often, such behavior is observed in production itself, unless project team is following practices of <a href="https://netflixtechblog.com/tagged/chaos-engineering">Chaos engineering</a>.</p>
<p>Wouldn&rsquo;t it be great if it is possible to start testing the resiliency features as part of development and during CI/CD pipeline execution itself ? Enter <a href="https://toxiproxy.io">Toxiproxy</a></p>
<p>Toxiproxy is a TCP Proxy to simulate network and system conditions for chaos and resiliency Testing.</p>
<p>Toxiproxy essentially acts as middleman between your application and remote service/system being tested, allowing injection of delays, simulate Bandwidth restriction or turn interface off (down)
etc.</p>
<p>It provides CLI as well as http API for applications to  inject these behaviors or toxics. Refer <a href="https://github.com/shopify/toxiproxy#toxics">here</a> for various toxics supported.</p>
<h3 id="lets-use-toxiproxy">Lets use Toxiproxy</h3>
<p>Lets see how one can use it in typical use case where Application uses PostgreSQL database and requirement is to benchmark it against database hosted remotely. Toxiproxy can help simulate production like behavior by means of introducing network delay.</p>
<p>The full source code of this application is available <a href="https://github.com/sachinsu/toxiproxyPOC">here</a>. One can refer to Numbers (only as reference cause live conditions may widely vary) <a href="https://github.com/sirupsen/napkin-math">here</a> while deciding on how much toxicity to introduce.</p>
<p>Application itself is a Web server in <a href="https://golang.org">Go</a> using excellent <a href="https://github.com/julienschmidt/httprouter">HTTPRouter</a>, It does,</p>
<ul>
<li>
<p>provision a table in Postgresql and load <a href="https://github.com/sachinsu/toxiproxyPOC/tree/main/assets">dummy data</a> in it.</p>
</li>
<li>
<p>Exposes REST API that reads data from database and returns JSON</p>
</li>
<li>
<p>Setup proxy between application and database either through Toxiproxy CLI (it can also be done programmatically using Toxiproxy-Go client),</p>
<pre><code>    [
        {
            &quot;name&quot;: &quot;pgsql&quot;, 
            &quot;listen&quot; : &quot;[::]:6000&quot;,
            &quot;upstream&quot; : &quot;127.0.0.1:5432&quot;,
            &quot;enabled&quot;: true
        }
    ]
</code></pre><p>or through Code like,</p>
<pre><code>    // InjectLatency helper
    func InjectLatency(name string, delay int) *toxiproxy.Proxy {
        proxy, err := toxiClient.Proxy(name)

        if err != nil {
            panic(err)
        }

        proxy.AddToxic(&quot;&quot;, &quot;latency&quot;, &quot;&quot;, 1, toxiproxy.Attributes{
            &quot;latency&quot;: delay,
        })
        return proxy
    }
</code></pre></li>
<li>
<p>Use <a href="https://github.com/rakyll/hey">hey</a> or any other HTTP Benchmarking tool to test end points with and without toxicity</p>
</li>
</ul>
<p>or</p>
<ul>
<li>Go <a href="https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go">benchmark</a> <a href="https://github.com/sachinsu/toxiproxyPOC/tree/main/api/server">tests</a> tests that are executed against HTTP end points.</li>
</ul>
<p>In my opinion, Toxiproxy allows us to embed aspect(s) of resiliency verification in the code itself so developer can test it before committing the code and it can be embedded in DevOps pipeline to get early feedback before facing the music in production environment.</p>
<p>Like latency, one can easily introduce other Toxics like Bandwidth, Down and Timeout to check Application&rsquo;s behavior when faced with such occurrences.</p>
<h3 id="useful-references">Useful References,</h3>
<ul>
<li><a href="https://toxiproxy.io">ToxiProxy</a> - for all details on the tool like Clients available in various languages, server releases and so on.</li>
</ul>
<p>Happy Coding !!</p>
<hr>
<script src="https://utteranc.es/client.js" repo="sachinsu/sachinsu.github.io" issue-term="title" label="blogcomment"
    theme="github-light" crossorigin="anonymous" async></script>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/chaosengineering/" rel="tag">Chaosengineering</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/golang/" rel="tag">golang</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/postgresql/" rel="tag">postgresql</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/toxiproxy/" rel="tag">toxiproxy</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/shopify/" rel="tag">shopify</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<div class="authorbox__header">
		<span class="authorbox__name">About Sachin Sunkle</span>
	</div>
	<div class="authorbox__description">
		A Coder in IT
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/temporalworkflow/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Using Temporal.io to build Long running Workflows</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/restapiversioning/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Learnings from Jeff Richter&#39;s Designing and Versioning HTTP REST APIs Video Course</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 Sachin Sunkle.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>